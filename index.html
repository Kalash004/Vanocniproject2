<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Document</title>
    </head>
    <body>
        <span id="colorcode">colorcode</span>
        <span id="questioncolor"></span>
        <div id="buttons">
        </div>
        <h3 id="_starting_m">Guess the color</h3>
        <!--
            can be : Try Again. That color was #
            or : Correct! + create button
        -->
        <span id="message"></span>
        <br>
        <label for="difficulty">Difficulty:</label>
        <input id="difficulty" type="number">
        <br>
        <button onclick="main()" id="play">Play</button>
    </body>
    <style>
        #buttons {
            display: flexbox;
        }

        input {
            width: 50px;
        }
    </style>
    <script> 
        async function main() {
            await reset();
            let difficulty_input = document.getElementById("difficulty");
            let amount = Math.abs(difficulty_input.value);
            let color = questionColor();
            generate(amount);
            generateColors(amount,color);
        }

        function generate(amount) {
            let lastbutton = document.getElementById("button1");
            for (let q = 0; q<amount; q++) {
                let newb = addElement(q,lastbutton);
                lastbutton = newb;
            }
        }
        
        let createdColors;
        function generateColors(amount, color_answer) {
            let isAnswerAdded = false;
            createdColors = [];
            for (var q = 0; q<amount; q++) { // generating color for each circle
                let color = {
                    r: getRandomColor(),
                    g: getRandomColor(),
                    b: getRandomColor()
                } 
                for (var p = 0; p<createdColors.length; p++) { // checking for same colors in game
                    if (color.r == createdColors[p].r && color.g == createdColors[p].g && color.b == createdColors[p].b) {
                        q--;
                    }
                }
                let button = document.getElementById("button"+q);
                button.style.backgroundColor = "#"+color.r+""+color.g+""+color.b;
                if (!isAnswerAdded) { 
                    let randomnum = Math.floor(Math.random() * 3);
                    if (randomnum == 1) {
                        isAnswerAdded = true;
                        let button = document.getElementById("button"+q);
                        button.style.backgroundColor = "#"+color_answer.r+""+color_answer.g+""+color_answer.b;
                    }
                }
                if (amount-1 == q && !isAnswerAdded) {
                    // color last circle with answer color
                    let _lastbutton = document.getElementById("button"+q);
                    _lastbutton.style.backgroundColor = "#"+color_answer.r+""+color_answer.g+""+color_answer.b;
                    break;
                }
            }
        }
        
        function getRandomColor() {
            let num = (Math.floor(Math.random() * 254)+1).toString(16);
            if (num.length == 1) {
                num = num+""+0;
            } 
            return num;
        }
        
        function addElement(number,lastbutton) {
            const newButton = document.createElement("button");
            newButton.setAttribute('id','button'+number);
            newButton.setAttribute('class','colorholder');
            newButton.style.width = "100px";
            newButton.style.height = "100px";
            newButton.style.borderRadius = "50%";
            newButton.style.borderStyle = "none";
            document.getElementById("buttons").insertBefore(newButton,lastbutton);
        }

        function questionColor() {
            let color = {
                    r: getRandomColor(),
                    g: getRandomColor(),
                    b: getRandomColor()
                } 
            let questioncolor_field = document.getElementById("questioncolor");
            questioncolor_field.innerHTML = "#"+color.r+""+color.g+""+color.b;
            return color;
        }

        function reset() {
            let color_buttons = document.querySelectorAll('button[id^="butto"]');
            color_buttons.forEach(element => {
            element.remove();
           });
        }
    </script>
</html>
